server:
  port: ${GATEWAY_PORT:8080}

spring:
  application:
    name: gateway-api
  main:
    web-application-type: reactive
  cloud:
    gateway:
      routes:
        - id: auth-service
          uri: ${AUTH_SERVICE_URI:http://localhost:8000}
          predicates:
            - Path=/api/membership/**
          filters:
            - StripPrefix=1

        - id: product-service
          uri: ${PRODUCT_SERVICE_URI:http://localhost:9001}
          predicates:
            - Path=/api/products/**
          filters:
            - StripPrefix=1
            - name: CircuitBreaker
              args:
                name: productCB
                fallbackUri: forward:/__fallback/products

        - id: order-service
          uri: ${ORDER_SERVICE_URI:http://localhost:9002}
          predicates:
            - Path=/api/orders/**
          filters:
            - StripPrefix=1
            - name: CircuitBreaker
              args:
                name: orderCB
                fallbackUri: forward:/__fallback/orders

        - id: cart-service
          uri: ${CART_SERVICE_URI:http://localhost:9001}
          predicates:
            - Path=/api/cart/**
          filters:
            - StripPrefix=1

        - id: review-service
          uri: ${REVIEW_SERVICE_URI:http://localhost:9004}
          predicates:
            - Path=/api/reviews/**
          filters:
            - StripPrefix=1

        - id: payment-service
          uri: ${PAYMENT_SERVICE_URI:http://localhost:9005}
          predicates:
            - Path=/api/payments/**
          filters:
            - StripPrefix=1

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,metrics,loggers
  endpoint:
    health:
      show-details: when_authorized

gateway:
  cors:
    allowed-origins: ${FRONTEND_ORIGINS:http://localhost:3000,http://localhost:5173,http://localhost:5174}
    allowed-methods: GET,POST,PUT,PATCH,DELETE,OPTIONS
    allowed-headers: "*"
    exposed-headers: "X-Request-Id"
    allow-credentials: true
  security:
    jwt:
      enabled: ${JWT_ENABLED:false}
      secret: ${JWT_SECRET:}
      secured-paths: ${SECURED_PATHS:/api/orders/**,/api/cart/**,/api/payments/**,/api/reviews/**}
logging:
  level:
    root: INFO
    org.springframework.cloud.gateway: INFO
    com.cs308.gateway: DEBUG
